version: 1.0
runtime: python3.11

build:
  image:
    imageConfiguration:
      # Commandes pour la construction de l'application
      buildCommands:
        # Nettoyage de tout environnement virtuel existant pour éviter les conflits
        - rm -rf venv/
        # Création d'un environnement virtuel
        - python3 -m venv venv
        # Activation de l'environnement virtuel et installation des dépendances
        - source venv/bin/activate && python3 -m pip install -r /app/api/requirements.txt
      # Commande pour démarrer l'application
      startCommand: |
        source venv/bin/activate
        python3 /app/api/app.py

deployment:
  # Définir le port d'écoute de l'application
  port: 8080

logs:
  # Configuration des logs (CloudWatch)
  cloudwatch:
    group: /aws/app-runner/your-service-name
    stream: app-logs
    retentionInDays: 7